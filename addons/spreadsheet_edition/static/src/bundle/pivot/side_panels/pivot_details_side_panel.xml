<?xml version="1.0" encoding="utf-8"?>
<templates>
    <div
        t-name="spreadsheet_edition.PivotDetailsSidePanel"
        class="o_spreadsheet_pivot_side_panel h-100 overflow-hidden d-flex justify-content-between flex-column">
        <t t-set="isReadonly" t-value="env.model.getters.isReadonly()"/>
        <div class="h-100 position-relative overflow-x-hidden overflow-y-auto" t-ref="pivotSidePanel">
            <div
                t-if="isModelValid"
                t-att="isReadonly ? ['inert', 1] : []"
                t-att-class="{ 'pe-none opacity-50': isReadonly }">
                <PivotTitleSection pivotId="props.pivotId" flipAxis.bind="flipAxis"/>
                <t t-set="definition" t-value="store.definition"/>
                <div class="o-section">
                    <div class="o-section-title">Model</div>
                    <div class="o_model_name"><t t-esc="modelDisplayName"/> (<t t-esc="definition.model"/>)</div>
                </div>
                <OdooPivotLayoutConfigurator
                    unusedGroupableFields="store.unusedGroupableFields"
                    measureFields="store.measureFields"
                    definition="definition"
                    unusedGranularities="store.unusedGranularities"
                    dateGranularities="store.dateGranularities"
                    datetimeGranularities="store.datetimeGranularities"
                    onDimensionsUpdated.bind="onDimensionsUpdated"
                    pivotId="props.pivotId"
                    getScrollableContainerEl.bind="getScrollableContainerEl"
                />
                <SidePanelDomain
                    resModel="definition.model"
                    domain="definition.domain"
                    onUpdate.bind="onDomainUpdate"
                />
                <RelatedFiltersSection
                    resModel="definition.model"
                    dataSourceId="props.pivotId"
                    dataSourceType="'pivot'"
                />
                <div class="o-section pt-1">
                    <div class="o_pivot_last_update text-muted"><i>Last updated at <t t-esc="getLastUpdate()"/></i></div>
                </div>
                <div class="o-section py-1" t-if="env.model.getters.isPivotUnused(props.pivotId)">
                    <ValidationMessages messages="[unusedPivotWarning]" msgType="'warning'"/>
                </div>
            </div>
            <div t-else="1">
                <ValidationMessages messages="[invalidPivotModel]" msgType="'error'"/>
                <button class="mx o-button o-button-primary mt-2 m-1" t-on-click="delete">Delete Pivot</button>
            </div>
        </div>
        <PivotDeferUpdate
            t-if="isModelValid and !isReadonly"
            deferUpdate="store.updatesAreDeferred"
            toggleDeferUpdate="(value) => store.deferUpdates(value)"
            isDirty="store.isDirty"
            discard="store.discardPendingUpdate"
            apply="store.applyUpdate"
        />
    </div>
</templates>
