<templates id="template" xml:space="preserve">
    <t t-name="ai_website_livechat.AILivechatComponent">
        <div class="flex-grow-1" t-ref="messagesDiv" t-if="state.messages.length">
            <div t-foreach="state.messages" t-as="message" t-key="message_index"
                class="py-1 overflow-x-auto o_ai_livechat_message_with_copy_button"
                t-att-class="{
                    'mt-2': message_index,
                    'mt-0': !message_index,
                    'justify-content-end d-flex': message.author === 'user'
                }"
            >
                <div class="rounded text-break py-2 o_ai_livechat_message_content"
                    t-att-class="{'px-3 bg-200': message.author === 'user'}"
                >
                    <t t-out="message.text"/>
                </div>
                <div class="o_show_on_message_hover" t-if="message.author === 'assistant'">
                    <button class="btn p-0 border-0" t-on-click="() => this.copyAnswer(message_index)">
                        <i class="fa fa-fw fa-clone fa-sm text-muted"></i>
                    </button>
                </div>
            </div>
            <div t-if="state.assistantThinking" class="d-flex align mb-3">
                <img src="/web/static/img/spin.svg" alt="Loading..." class="me-2"
                    style="filter:invert(1); opacity: 0.5; width: 30px; height: 30px;"/>
                <p class="m-0 text-muted align-self-center">
                    <em>Thinking...</em>
                </p>
            </div>
        </div>
        <div class="d-flex m-0 gap-2 gap-xl-4" t-att-class="{'o_ai_livechat_form_container_sticky position-sticky': state.messages.length}">
            <div class="flex-column flex-grow-1">
                <div class="mb-1" t-att-class="{'d-none': !state.messages.length,}">
                    <button t-if="livechatAvailable" class="btn btn-primary small rounded-2 py-1 px-3 me-3" t-att-disabled="state.assistantThinking" t-on-click="askHuman">Ask a Human</button>
                    <a t-elif="fallbackButtonActive" class="btn btn-primary small rounded-2 py-1 px-3 me-3" t-att-disabled="state.assistantThinking" t-att-href="props.fallbackButtonURL">
                        <t t-out="props.fallbackButtonText"/>
                    </a>
                    <button class="btn btn-dark small rounded-2 py-1 px-3 me-3" t-att-disabled="state.assistantThinking" t-on-click="closeConversation">Close</button>
                </div>
                <div class="ai_website_livechat_form form-control d-flex align-items-center w-100 py-0 ps-lg-3 ps-xl-4 pe-lg-2">
                    <textarea type="text" t-ref="promptInput"
                        name="promptInput" t-on-keydown="onTextareaKeydown"
                        class="flex-grow-1 overflow-hidden form-control-plaintext border-0 shadow-none"
                        t-att-disabled="state.assistantThinking"
                        rows="1"
                        style="resize:none;"
                        t-att-placeholder="props.promptPlaceholder"
                        autocomplete="off"
                        t-model="state.prompt" required="required">
                    </textarea>
                    <div class="align-self-baseline py-2">
                        <t t-set="isEmpty" t-value="state.prompt.trim() === ''"/>
                        <button
                            class="ai_website_livechat_form_button btn btn-sm border-0"
                            t-att-class="{'disabled': isEmpty}"
                            t-att-disabled="isEmpty"
                            t-on-click="submitPrompt"
                            title="Submit"
                        >
                            <i class="fa fa-fw fa-lg fa-paper-plane fs-5" style="scale: .75;" role="presentation"/>
                        </button>
                    </div>
                </div>
            </div>
            <div t-if="livechatAvailable || fallbackButtonActive" class="flex-grow-0 d-flex gap-2 gap-xl-4 align-items-center text-nowrap" t-att-class="{'d-none': state.messages.length}">
                <span class="text-muted">or</span>
                <button t-if="livechatAvailable" class="btn btn-primary w-lg-100 ask-human" t-on-click="askHuman">Ask a Human</button>
                <a t-elif="fallbackButtonActive" class="btn btn-primary w-lg-100 fallback-btn" role="button" t-att-href="props.fallbackButtonURL">
                    <t t-out="props.fallbackButtonText"/>
                </a>
            </div>
        </div>
    </t>
</templates>
