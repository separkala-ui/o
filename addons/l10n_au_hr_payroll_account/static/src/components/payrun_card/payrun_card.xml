<?xml version="1.0" encoding="UTF-8"?>
<templates>
    <t t-name="l10n_au_hr_payroll_account.PayRunCard" t-inherit="hr_payroll.PayRunCard" t-inherit-mode="extension">
        <t t-set-slot="paid_prio" position="before">
            <t t-set-slot="l10n_au_ato" isVisible="payrun.l10n_au_stp_status == 'ready' &amp;&amp; payrun.country_code == 'AU'">
                <ViewButton className="'btn btn-primary'"
                            clickParams="{type: 'object', name: 'action_open_stp'}"
                            record="props.record"
                            string.translate="Submit to ATO"/>
            </t>
            <t t-set-slot="l10n_au_register_payment" isVisible="payrun.state == '02_close' &amp;&amp; payrun.l10n_au_stp_status == 'sent' &amp;&amp; payrun.country_code == 'AU'">
                <ViewButton className="'btn btn-primary'"
                            clickParams="{type: 'object', name: 'action_register_payment', context: {dont_redirect_to_payments: true, hr_payroll_payment_register: true, hr_payroll_payment_register_batch: props.record.resId}}"
                            record="props.record"
                            string.translate="Pay"/>
            </t>
        </t>

        <t t-set-slot="paid_prio" position="attributes">
            <attribute name="isVisible" add="(payrun.l10n_au_stp_status == 'sent' || payrun.country_code != 'AU')" separator="&amp;&amp;"/>
        </t>

        <t t-set-slot="gen_report" position="attributes">
            <attribute name="isVisible" add="(payrun.l10n_au_stp_status == 'sent' || state != '03_paid' || payrun.country_code != 'AU')" separator="&amp;&amp;"/>
        </t>

        <PayRunButtonBox position="inside">
            <t t-set-slot="open_payment_batch" isVisible="payrun.l10n_au_payment_batch_id" isSmartButton="true">
                <ViewButton className="'oe_stat_button'"
                            icon="'fa-dollar'"
                            clickParams="{type: 'object', name: 'action_open_payment_batch'}"
                            record="props.record">
                    <t t-set-slot="contents">
                        <div class="o_stat_info">
                            <span class="o_stat_text">Payment Batch</span>
                            <span class="o_stat_value text-center">
                                <field name="l10n_au_payment_batch_state"/>
                            </span>
                        </div>
                    </t>
                </ViewButton>
            </t>
            <t t-set-slot="open_stp" isVisible="['ready', 'sent'].includes(payrun.l10n_au_stp_status) &amp;&amp; payrun.country_code == 'AU'" isSmartButton="true" group="'account.group_account_readonly'">
                <ViewButton className="'oe_stat_button'"
                            icon="'fa-book'"
                            clickParams="{type: 'object', name: 'action_open_stp', help: 'Generated Payslips'}"
                            record="props.record">
                    <t t-set-slot="contents">
                        <div class="o_field_widget o_stat_info">
                            <span class="o_stat_text">STP Submission</span>
                            <span class="o_stat_value"><field name="l10n_au_stp_count"/></span>
                        </div>
                    </t>
                </ViewButton>
            </t>
        </PayRunButtonBox>

        <MoreInfo position="inside">
            <t t-set-slot="l10n_au_stp_status" isVisible="true" group="'base.group_no_one'">
                <span class="col fw-medium">
                    <t t-esc="this.props.record.fields.l10n_au_stp_status.string"/>
                </span>
                <div class="col mb-3 mb-sm-0">
                    <Field name="'l10n_au_stp_status'" record="props.record"/>
                </div>
            </t>
        </MoreInfo>
    </t>
</templates>
