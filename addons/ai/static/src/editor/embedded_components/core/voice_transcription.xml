<?xml version="1.0" encoding="utf-8"?>
<templates id="template" xml:space="preserve">
    <t t-name="ai.VoiceTranscription">
        <details t-attf-id="transcriber-#{embeddedState.id}" class="transcript-block border border-secondary mb-2" t-att-open="state.isOpened">
            <summary class="d-flex bg-secondary-subtle px-2 py-1 fw-bold gap-2 flex-sm-row flex-column align-items-sm-center flex-wrap" t-on-click="() => state.isOpened = !state.isOpened" t-att-class="{'py-2': !state.isOpened}">
                <t t-if="state.isOpened">
                    <i class="fa fa-caret-down flex-0 me-1" />
                    <nav class="d-flex gap-1 flex-wrap">
                        <button 
                            class="btn flex-grow-1 flex-sm-grow-0 w-100 w-sm-auto lh-1"
                            t-if="embeddedState.hasSummary || embeddedState.status === 'summarizing'"
                            t-att-class="{'btn-secondary active': state.currentTab === 'summary'}"
                            t-on-click.stop="() => this.setCurrentTab('summary')"
                            t-att-disabled="embeddedState.status === 'summarizing'">
                            <t t-if="embeddedState.status === 'summarizing'">
                                <div class="spinner-border spinner-border-sm me-1" role="status"/>
                                Processing...
                            </t>
                            <t t-else="">
                                <img src="/ai/static/description/icon.png" class="ai-icon-sm me-1 w-1"/>
                                Summary
                            </t>
                        </button>
                        <button class="btn flex-sm-grow-0 w-100 w-sm-auto" 
                            t-att-class="{'btn-secondary active': state.currentTab === 'notes'}"
                            t-on-click.stop="() => this.setCurrentTab('notes')">
                            <i class="fa fa-bars me-1"/>
                            Notes
                        </button>
                        <button 
                            class="btn flex-sm-grow-0 w-100 w-sm-auto"
                            t-att-class="{'btn-secondary active': state.currentTab === 'transcript'}"
                            t-on-click.stop="() => this.setCurrentTab('transcript')"
                            >
                            <i class="fa fa-microphone me-1"/>
                            Transcript
                        </button>
                    </nav>
                    <div class="d-flex flex-wrap gap-2 ms-lg-auto" t-if="state.currentTab !== 'summary'"> 
                        <select t-if="supportedLanguages?.length > 1" class="form-select flex-sm-grow-0 w-100 w-sm-auto" t-on-click.stop="" t-model="state.currentLanguage" t-att-disabled="embeddedState.status === 'recording'">
                            <t t-foreach="supportedLanguages" t-as="language" t-key="language_index">
                                <option t-att-value="language.code" t-att-selected="language.code === state.currentLanguage"><t t-out="language.shortCode"/></option>
                            </t>
                        </select>
                        <button 
                            class="btn btn-secondary flex-sm-grow-0 w-100 w-sm-auto flex-sm-shrink-0"
                            t-on-click.stop="toggleRecording"
                            t-att-disabled="embeddedState.status === 'summarizing' || embeddedState.status === 'waiting'">
                            <t t-if="embeddedState.status === 'recording'">
                                <i class="fa fa-stop text-danger me-1"/>
                                Stop Recording
                            </t>
                            <t t-else="">
                                <i class="fa fa-circle text-danger me-1"/>
                                Start Recording
                            </t>
                        </button>
                    </div>
                    <button class="btn btn-secondary ms-lg-auto" t-on-click.stop="openComposer" t-att-disabled="embeddedState.status === 'summarizing'" t-elif="props.resId">
                        <i class="fa fa-envelope me-1"/>
                        Share by email
                    </button>
                </t>
                <t t-else="">
                    <i class="fa fa-caret-right flex-0 me-1"/>
                    Voice Recording <span t-out="state.firstRecordingDate" class="ms-1"/>
                </t>
            </summary>
            <div class="detail-content overflow-auto"  t-att-class="{'d-none': state.currentTab !== 'summary'}">
                <header t-if="composerPrompts.available_prompts?.length > 0" class="d-flex gap-2 flex-wrap mb-2">
                    <t t-foreach="composerPrompts.available_prompts" t-as="prompt" t-key="prompt_index">
                        <button class="btn btn-secondary" t-on-click="() => this.updateSummary(prompt.name)">
                            <t t-out="prompt.name" />
                        </button>
                    </t>
                </header>
                <div id="summary-content"  t-ref="summaryContent" t-att-class="{ 'o-ai-summary-processing': embeddedState.status ===â€¯'summarizing' }"/>
            </div>
            <div id="notes-content" class="detail-content overflow-auto" t-att-class="{'d-none': state.currentTab !== 'notes'}" t-ref="notesContent"/>
            <div id="transcript-content" class="detail-content overflow-auto" t-att-class="{'d-none': state.currentTab !== 'transcript'}" t-ref="transcriptContent"/>
        </details>
    </t>
</templates>
