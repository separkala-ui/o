<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record model="res.groups.privilege" id="res_groups_privilege_databases">
        <field name="name">Databases</field>
        <field name="sequence">30</field>
        <field name="category_id" ref="base.module_category_services"/>
    </record>

    <record id="group_databases_user" model="res.groups">
        <field name="name">User</field>
        <field name="comment">User can access the client databases</field>
        <field name="sequence">10</field>
        <field name="implied_ids" eval="[(4, ref('project.group_project_user'))]"/>
        <field name="privilege_id" ref="res_groups_privilege_databases"/>
    </record>

    <record id="group_databases_manager" model="res.groups">
        <field name="name">Administrator</field>
        <field name="comment">Administrator can manage the client databases</field>
        <field name="sequence">20</field>
        <field name="privilege_id" ref="res_groups_privilege_databases"/>
        <field name="implied_ids" eval="[(4, ref('databases.group_databases_user')), (4, ref('project.group_project_manager'))]"/>
        <field name="user_ids" eval="[(4, ref('base.user_root')), (4, ref('base.user_admin'))]"/>
    </record>

    <data noupdate="1">

        <record id="databases_manager_project_project_rule" model="ir.rule">
            <field name="name">Databases administrators can see all databases</field>
            <field name="model_id" ref="model_project_project"/>
            <field name="domain_force">[('database_hosting', '!=', False)]</field>
            <field name="groups" eval="[(4, ref('group_databases_manager'))]"/>
        </record>

        <record id="databases_user_project_project_rule" model="ir.rule">
            <field name="name">Databases users can see a database if they have an account</field>
            <field name="model_id" ref="model_project_project"/>
            <field name="domain_force">['&amp;', ('database_hosting', '!=', False), ('database_user_ids.login', '=', user.login)]</field>
            <field name="groups" eval="[(4, ref('group_databases_user'))]"/>
        </record>

        <record id="project.project_project_manager_rule" model="ir.rule">
            <field name="name">Project: project manager: see all but databases</field>
            <field name="domain_force">[('database_hosting', '=', False)]</field>
        </record>

    </data>

</odoo>
